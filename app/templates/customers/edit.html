<h2 class="text-xl font-bold mb-4">
  Customer: {{ customer.first_name }} {{ customer.last_name }}
</h2>

<form
    hx-post="{{ url_for('upsert_customer') }}"
    hx-target="#customer-list"
    hx-swap="innerHTML"
    hx-ext="json-enc"
    hx-headers='{"Content-Type": "application/json"}'
    hx-on:htmx:configRequest="(evt) => {
        const data = evt.detail.parameters;
        for (const key in data) {
            if (data[key] === '') data[key] = null;
        }
    }"
>

    {% if customer.id %}
    <!-- ID -->
    <div class="mb-2 hidden">
        <label class="block font-semibold">ID</label>
        <input type="text" name="id" value="{{ customer.id }}" class="border p-1 w-full"/>
    </div>
    {% endif %}

    <!-- First Name -->
    <div class="mb-2">
        <label class="block font-semibold">First Name</label>
        <input type="text" name="first_name" value="{{ customer.first_name or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Last Name -->
    <div class="mb-2">
        <label class="block font-semibold">Last Name</label>
        <input type="text" name="last_name" value="{{ customer.last_name or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- User ID -->
    <div class="mb-2">
        <label class="block font-semibold">User ID</label>
        <input type="text" name="user_id" value="{{ customer.user_id or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Code Name -->
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="code_name" value="1" {% if customer.code_name %}checked{% endif %} class="mr-2"/>
            Code Name
        </label>
    </div>

    <!-- Email -->
    <div class="mb-2">
        <label class="block font-semibold">Email</label>
        <input type="email" name="email" value="{{ customer.email or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Phone -->
    <div class="mb-2">
        <label class="block font-semibold">Phone</label>
        <input type="text" name="phone" value="{{ customer.phone or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Location -->
    <div class="mb-2">
        <label class="block font-semibold">Location</label>
        <input type="text" name="location" value="{{ customer.location or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Contributes -->
    <div class="mb-2">
        <label class="block font-semibold">Contributes</label>
        <select name="contributes" class="border p-1 w-full">
            <option value="" {% if customer.contributes is none %}selected{% endif %}>Select...</option>
            <option value="1" {% if customer.contributes == 1 %}selected{% endif %}>No contributions</option>
            <option value="2" {% if customer.contributes == 2 %}selected{% endif %}>Contributes</option>
            <option value="3" {% if customer.contributes == 3 %}selected{% endif %}>Silver</option>
            <option value="4" {% if customer.contributes == 4 %}selected{% endif %}>Gold</option>
        </select>
    </div>

    <!-- Caller -->
    <div class="mb-2">
        <label class="block font-semibold">Caller</label>
        <select name="caller_id" class="border p-1 w-full">
            <option value="" {% if customer.caller is none %}selected{% endif %}>Select...</option>
            {% for caller in callers %}
              <option value="{{ caller.id }}" {% if customer.caller_id == caller.id %}selected{% endif %}>{{ caller.name }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Comment -->
    <div class="mb-2">
        <label class="block font-semibold">Comment</label>
        <textarea name="comment" class="border p-1 w-full">{{ customer.comment or '' }}</textarea>
    </div>

    <!-- Sub Caller -->
    <div class="mb-2">
        <label class="block font-semibold">Sub Caller</label>
        <input type="text" name="sub_caller" value="{{ customer.sub_caller or '' }}" class="border p-1 w-full"/>
    </div>

    <!-- Organisations -->
    <div class="mb-2">
        <label class="block font-semibold">Organisations</label>
        <select name="organisations" multiple class="border p-1 w-full">
            {% for org in organisations %}
                <option value="{{ org.id }}"
                    {% if org.id|string in customer.organisations %}selected{% endif %}>
                    {{ org.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Categories -->
    <div class="mb-2">
        <label class="block font-semibold">Categories</label>
        <select name="categories" multiple class="border p-1 w-full">
          {% for cid, cat in categories.items() %}
            <optgroup label="{{ cat.name }}">
              {% for iid, item in cat.get('items', {}).items() %}
                <option value="{{ iid }}" {% if iid in customer.categories %}selected{% endif %}>
                  {{ item }}
                </option>
              {% endfor %}
            </optgroup>
          {% endfor %}
        </select>
    </div>

<!-- Personality Type -->
<div class="mb-2">
    <label class="block font-semibold">Personality Type</label>
    <select name="personality_type" class="border p-1 w-full">
        <option value="" {% if customer.personality_type is none %}selected{% endif %}>Select...</option>
        {% for p in personalities %}
            <option value="{{ p.id }}" {% if customer.personality_type == p.id %}selected{% endif %}>
                {{ p.name }}
            </option>
        {% endfor %}
    </select>
</div>

    <!-- Boolean Preferences -->
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="controlled" {% if customer.controlled %}checked{% endif %} class="mr-2"/>
            Controlled
        </label>
    </div>
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="likes_parties" {% if customer.likes_parties %}checked{% endif %} class="mr-2"/>
            Likes Parties
        </label>
    </div>
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="likes_politics" {% if customer.likes_politics %}checked{% endif %} class="mr-2"/>
            Likes Politics
        </label>
    </div>
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="likes_lectures" {% if customer.likes_lectures %}checked{% endif %} class="mr-2"/>
            Likes Lectures
        </label>
    </div>
    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" name="likes_activism" {% if customer.likes_activism %}checked{% endif %} class="mr-2"/>
            Likes Activism
        </label>
    </div>

    <!-- Tags -->
    <div class="mb-2">
        <label class="block font-semibold">Tags (comma separated)</label>
        <input type="text" name="tags" value="{{ customer.tags | default('') }}" class="border p-1 w-full"/>
    </div>

    <!-- Extra JSON -->
    <div class="mb-2">
        <label class="block font-semibold">Extra (JSON)</label>
        <textarea name="extra" class="border p-1 w-full">{{ customer.extra | default('{}') }}</textarea>
    </div>

    <div class="flex justify-end mt-4">
        <button @click="modalOpen = false" type="submit" class="px-3 py-1 bg-blue-500 text-white rounded">Save</button>
    </div>

</form>
