<div class="mb-1"><strong>{{ "Name" | t }}:</strong> {{ event.name }}</div>

{% if event.price is not none and event.price > 0 %}
<div class="mb-1"><strong>{{ "Price" | t }}:</strong> {{ event.price }} SEK</div>
{% endif %}

{% if event.description %}
<div class="mb-1"><strong>{{ "Description" | t }}:</strong> {{ event.description }}</div>
{% endif %}

<div class="mb-1"><strong>{{ "Start Date" | t }}:</strong> {{ event.start_date.strftime('%Y-%m-%d %H:%M') }}</div>

{% if event.end_date %}
<div class="mb-1"><strong>{{ "End Date" | t }}:</strong> {{ event.end_date.strftime('%Y-%m-%d %H:%M') }}</div>
{% endif %}

<div class="mb-1"><strong>{{ "Event Types" | t }}:</strong>
    {% set types = [] %}
    {% if event.type_a %}{% set _ = types.append('Party') %}{% endif %}
    {% if event.type_b %}{% set _ = types.append('AW') %}{% endif %}
    {% if event.type_c %}{% set _ = types.append('Föreläsning') %}{% endif %}
    {% if event.type_d %}{% set _ = types.append('Aktivism') %}{% endif %}
    {% if event.type_e %}{% set _ = types.append('Konferens') %}{% endif %}
    {{ types | join(', ') if types else '' }}
</div>

    {% set extras = [] %}
    {% if event.extra_external %}{% set _ = extras.append('Extern') %}{% endif %}
    {% if event.extra_non_political %}{% set _ = extras.append('Opolitisk') %}{% endif %}
    {% if event.extra_visilble_all %}{% set _ = extras.append('Synlig för alla') %}{% endif %}

{% if extras %}
<div class="mb-1"><strong>{{ "Extra" | t }}:</strong>
    {{ extras | join(', ') if extras else '' }}
{% endif %}


<br/>    
<br/>

<div x-data="{ active: '{{ status_filter or "all" }}' }" class="flex flex-wrap gap-2 mb-4">
    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=2"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 2}" >
        {{ "Not interested" | t }}
        <span>{{ totals.s2 }}</span>
    </button>

    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=1"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 1}" >
        {{ "Interested" | t }}
        <span >{{ totals.s1 }}</span>
    </button>

    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=3"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 3}" >
        {{ "Comming" | t }}
        <span>{{ totals.s3 }}</span>
    </button>

    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=4"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 4}" >
        {{ "Paid" | t }}
        <span>{{ totals.s4 }}</span>
    </button>

        <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=6"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 6}" >
        {{ "Pay at the door" | t }}
        <span>{{ totals.s6 }}</span>
    </button>

    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=5"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 5}" >
        {{ "Attended" | t }}
        <span>{{ totals.s5 }}</span>
    </button>

        <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short&status_filter=7"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 7}" >
        {{ "Did not attend" | t }}
        <span>{{ totals.s7 }}</span>
    </button>

    <button 
        hx-get="{{ url_for('event_detail', event_id=event.id) }}?list=short"
        hx-target="#event-info"
        class="px-3 py-1 border rounded hover:bg-gray-200"
        :class="{'bg-gray-100': {{ status_filter }} === 0}" >
        {{ "All" | t }}
        <span>
            {{ totals.all }}
        </span>
    </button>


</div>

<table id="customer-table" class="w-full border border-gray-300 mt-2 table-fixed">
    <thead class="bg-gray-100">
        <tr>
            <th class="px-3 py-2 border w-[50%]">{{ "Name" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Not interested" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Interested" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Comming" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Paid" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Pay at the door" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Attended" | t }}</th>
            <th class="px-3 py-1 border w-[10%]">{{ "Did not attend" | t }}</th>
            
        </tr>
    </thead>
    <tbody>
        {% for ec in event_customers %}

{% set enableRow = user.admin > 0 or user.caller_id == ec.customer.caller_id %}
<tr class="hover:bg-gray-100 {% if enableRow %} {% endif %} {% if not enableRow %} bg-gray-50 {% endif %}">
    
    <!-- Customer name -->
    <td class="px-3 py-2 border">
      {{ ec.customer.first_name }} {{ ec.customer.last_name }}
    </td>

    <!-- STATUS RADIOS -->
    {% for status in [2,1,3,4,6,5,7] %}
    <td class="px-3 border text-center">

    <label class="custom-radio {% if not enableRow %}pointer-events-none{% endif %}">

        <input
        type="radio"
        name="dummy-{{ ec.customer.id }}"
        value="{{ status }}"
        {% if ec.status == status %} checked {% endif %}

        hx-trigger="change"
        hx-post="{{ url_for('save_call') }}"
        hx-swap="none"
        hx-ext="json-enc"

        hx-include="#status-form"
        hx-vals='{
          "customer_id": "{{ ec.customer.id }}",
          "event_status": "{{ status }}"
        }'
      >
      </label>


    </td>
    {% endfor %}

  </tr>

        

        {% endfor %}
    </tbody>
</table>
<form id="status-form"
      hx-post="{{ url_for('save_call') }}"
      hx-swap="none"
      hx-ext="json-enc">

  <input type="hidden" name="event_id" value="{{ event.id }}">
  <input type="hidden" name="customer_id" value="">
  <input type="hidden" name="event_status" value="">
</form>
<br/>

<button onclick="printTable('customer-table')" class="px-3 py-1 border rounded bg-gray-100 hover:bg-gray-200">{{ "Print" | t }}</button>